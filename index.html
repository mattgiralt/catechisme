<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="description" content="Catéchisme en 145 questions et réponses. Navigation simple, favoris, mode sombre et réglages de lecture." />
  <meta property="og:title" content="Catéchisme" />
  <meta property="og:description" content="Catéchisme en 145 questions et réponses. Navigation simple, favoris, mode sombre et réglages de lecture." />
  <meta property="og:type" content="website" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Catéchisme" />
  <meta name="twitter:description" content="Catéchisme en 145 questions et réponses. Navigation simple, favoris, mode sombre et réglages de lecture." />
  <link rel="manifest" href="manifest.json" />
  <title>Catéchisme</title>
  <style>
    :root{
      --bg:#ffffff;
      --fg:#1d1d1f;
      --muted:#6b6b73;
      --card:#f4f4f6;
      --line:#e6e6ea;
      --accent:#2E2F33;
      --shadow:0 10px 30px rgba(0,0,0,.10);
      --radius:18px;
      --serif: ui-serif, "Iowan Old Style", "Palatino Linotype", Palatino, "Georgia", serif;
      --sans: ui-sans-serif, -apple-system, system-ui, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
      --focus:rgba(46,47,51,.25);

      /* Mobile-first sizing */
      --ui:14px;
      --q:clamp(34px, 7.6vw, 46px);
      --a:clamp(18px, 4.3vw, 22px);
      --tap:44px;
      --tap-lg:56px;
      --pad:20px;
    }

    body.theme-dark{
      --bg:#0b0b0d;
      --fg:#f5f5f7;
      --muted:#a2a2aa;
      --card:#151519;
      --line:#2a2a31;
      --accent:#4aa3ff;
      --focus:rgba(74,163,255,.25);
      --shadow:0 18px 45px rgba(0,0,0,.35);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      background:var(--bg);
      color:var(--fg);
      font-family:var(--sans);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* iOS viewport stability */
    .app{
      min-height:100vh;
      min-height:100dvh;
      display:flex;
      flex-direction:column;
    }

    header{
      position:sticky;
      top:0;
      z-index:10;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:
        calc(10px + env(safe-area-inset-top))
        var(--pad)
        10px
        var(--pad);
      backdrop-filter:saturate(1.2) blur(10px);
    }
    body.theme-light header{ background:rgba(255,255,255,.88); border-bottom:1px solid rgba(0,0,0,.04); }
    body.theme-dark header{ background:rgba(11,11,13,.78); border-bottom:1px solid rgba(255,255,255,.06); }

    .header-title{
      font-size:var(--ui);
      font-weight:600;
      letter-spacing:.2px;
      color:var(--muted);
      user-select:none;
    }

    .icon-btn{
      width:52px;
      height:52px;
      border:none;
      background:transparent;
      color:var(--fg);
      border-radius:14px;
      display:grid;
      place-items:center;
      cursor:pointer;
      font-size:22px;
      transition:transform .08s ease;
      -webkit-tap-highlight-color:transparent;
    }
    .icon-btn:active{ transform:scale(.98); }
    .icon-btn:focus-visible{ outline:3px solid var(--focus); outline-offset:2px; }
    .icon-btn svg,.mini svg,.nav .arrow svg{ width:24px; height:24px; display:block; }
    .icon-btn svg{ width:26px; height:26px; }
    .nav .arrow svg{ width:28px; height:28px; }
    .mini svg{ width:26px; height:26px; }
    .btn-icon{ stroke:currentColor; fill:none; stroke-width:2; stroke-linecap:round; stroke-linejoin:round; }
    .btn-icon.filled{ fill:currentColor; stroke:none; }
    .bookmarkBtn .star-fill{ opacity:0; transition:opacity .15s ease; }
    .bookmarkBtn.is-bookmarked .star-fill{ opacity:1; }

    main{
      flex:1;
      position:relative;
      padding:20px var(--pad) calc(20px + env(safe-area-inset-bottom));
      max-width:720px;
      width:100%;
      margin:0 auto;
    }

    .settings-backdrop{
      position:fixed;
      inset:0;
      background:transparent;
      display:none;
      z-index:5;
    }
    .settings-backdrop.show{ display:block; }
    #settingsView.active{ position:relative; z-index:6; }

    .view{ display:none; }
    .view.active{ display:block; }

    .question-wrap{
      padding:28px 0 200px;
    }

    .center{ text-align:center; }

    .qnum{
      font-size:12px;
      letter-spacing:.18em;
      color:var(--muted);
      margin:4px 0 18px;
    }

    .qtext{
      font-family:var(--serif);
      font-weight:600;
      font-size:var(--q);
      line-height:1.08;
      margin:0 0 16px;
      color:var(--accent);
    }
    body.theme-dark .qtext{ color:var(--fg); }

    .divider{
      width:min(220px, 62%);
      margin:16px auto 20px;
      height:2px;
      background:var(--accent);
      opacity:.85;
      border-radius:2px;
    }

    .answer{
      font-size:var(--a);
      line-height:1.35;
      margin:0 0 32px;
      color:var(--fg);
      transition:opacity .15s ease;
    }
    .answer.hidden{ opacity:0; height:0; margin:0; overflow:hidden; }

    .pill-btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:12px 18px;
      min-height:var(--tap);
      border:none;
      border-radius:999px;
      background:transparent;
      color:var(--accent);
      font-size:15px;
      font-weight:650;
      cursor:pointer;
      -webkit-tap-highlight-color:transparent;
      min-width:160px;
    }
    .pill-btn:focus-visible{ outline:3px solid var(--focus); outline-offset:2px; }

    .actions{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-top:14px;
      gap:10px;
    }
    .actions .pill-btn{ flex:0 0 auto; }
    .mini{
      width:var(--tap-lg);
      height:var(--tap-lg);
      border:none;
      border-radius:16px;
      background:transparent;
      color:var(--accent);
      cursor:pointer;
      display:grid;
      place-items:center;
      -webkit-tap-highlight-color:transparent;
    }
    .mini:focus-visible{ outline:3px solid var(--focus); outline-offset:2px; }
    .nav .mini{ font-size:24px; }

    .nav{
      position:fixed;
      bottom:0;
      left:50%;
      transform:translateX(-50%);
      width:100%;
      max-width:720px;
      display:flex;
      flex-direction:column;
      gap:14px;
      padding:16px var(--pad) calc(16px + env(safe-area-inset-bottom));
      background:var(--bg);
      box-sizing:border-box;
      touch-action:manipulation;
    }
    .nav .actions{ margin-top:0; }
    .nav-row{
      display:flex;
      align-items:center;
      gap:10px;
    }
    .nav .arrow{
      width:var(--tap-lg);
      height:var(--tap-lg);
      border:none;
      border-radius:16px;
      background:transparent;
      color:var(--accent);
      font-size:26px;
      cursor:pointer;
      display:grid;
      place-items:center;
      -webkit-tap-highlight-color:transparent;
      touch-action:manipulation;
    }
    .nav .arrow:disabled{ opacity:.4; cursor:not-allowed; }

    input[type="range"]{
      width:100%;
      height:28px;
      accent-color:var(--accent);
    }

    .list{
      overflow:hidden;
    }
    .list-item{
      display:flex;
      flex-direction:column;
      gap:0;
      padding:14px 0;
      border-bottom:1px solid var(--line);
      cursor:pointer;
      -webkit-tap-highlight-color:transparent;
    }
    .list-item:last-child{ border-bottom:none; }
    .list-item-empty{ justify-content:center; cursor:default; }
    .list-item-empty .t{ color:var(--muted); font-weight:600; }
    .list-item .n{
      flex:0 0 2.5em;
      width:2.5em;
      min-width:2.5em;
      color:var(--muted);
      font-weight:750;
      text-align:right;
      font-variant-numeric:tabular-nums;
    }
    .list-item .t{
      flex:1;
      min-width:0;
      font-family:var(--serif);
      color:var(--accent);
      font-weight:700;
      line-height:1.12;
    }
    body.theme-dark .list-item .t{ color:var(--fg); }
    .list-item-row{ display:flex; align-items:baseline; gap:12px; }
    .list-item-answer{
      display:none;
      padding:10px 0 6px 0;
      padding-left:52px;
      font-size:15px;
      line-height:1.4;
      color:var(--fg);
    }
    .list-item.expanded .list-item-answer{ display:block; }

    .content-card{
      padding:16px 0;
      line-height:1.55;
      font-size:15px;
      color:var(--fg);
    }
    .content-card h2{
      margin:0 0 10px;
      font-family:var(--serif);
      color:var(--accent);
      font-size:22px;
    }
    body.theme-dark .content-card h2{ color:var(--fg); }
    .content-card p{ margin:0 0 12px; }
    .content-card p:last-child{ margin:0; }

    /* Menu (top panel) */
    .sheet-backdrop{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.35);
      display:none;
      z-index:100;
    }
    .sheet-backdrop.show{ display:block; }

    .sheet{
      position:fixed;
      top:0;
      left:0;
      right:0;
      bottom:0;
      width:100%;
      padding:env(safe-area-inset-top) var(--pad) env(safe-area-inset-bottom);
      background:var(--bg);
      z-index:101;
      display:none;
      overflow:auto;
    }
    .sheet.show{ display:block; }

    .sheet header{
      position:static;
      padding:12px 0 8px;
      backdrop-filter:none;
      background:transparent;
    }
    .sheet-title{
      font-weight:750;
      color:var(--fg);
      font-size:16px;
    }
    .sheet-body{ padding:8px 0 14px; }

    .menu-list{ display:grid; gap:4px; }
    .menu-item{
      width:100%;
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:14px 0;
      min-height:var(--tap);
      background:none;
      border:none;
      color:var(--fg);
      cursor:pointer;
      text-align:left;
      font-size:15px;
      font-weight:650;
      -webkit-tap-highlight-color:transparent;
    }
    .menu-item small{ font-weight:600; color:var(--muted); }
    .sheet .icon-btn{ border:none; }

    .settings{ display:grid; gap:12px; }
    .row{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      padding:12px 0;
    }
    .row label{ font-weight:700; font-size:15px; line-height:1.25; }
    .row .sub{ display:block; font-weight:600; font-size:12px; color:var(--muted); margin-top:3px; }
    .row .toggle{ margin-top:-5px; }

    .toggle{
      width:52px;
      height:30px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.06);
      position:relative;
      cursor:pointer;
      flex:0 0 auto;
      -webkit-tap-highlight-color:transparent;
    }
    body.theme-dark .toggle{ background:rgba(255,255,255,.06); }
    .toggle .knob{
      position:absolute;
      top:3px;
      left:3px;
      width:24px;
      height:24px;
      border-radius:999px;
      background:var(--bg);
      border:1px solid var(--line);
      transition:left .15s ease;
    }
    .toggle.on{
      background:var(--accent);
      border-color:transparent;
    }
    .toggle.on .knob{ left:25px; }

    .slider-wrap{
      padding:12px 0;
    }
    .slider-wrap .lbl{
      font-weight:800;
      margin-bottom:10px;
      font-size:14px;
    }
    .font-size-options{
      display:flex;
      gap:10px;
      margin-top:12px;
    }
    .font-size-option{
      flex:1;
      padding:12px 8px;
      min-height:var(--tap);
      border-radius:12px;
      border:1px solid var(--line);
      background:transparent;
      color:var(--fg);
      font-size:15px;
      font-weight:650;
      cursor:pointer;
      -webkit-tap-highlight-color:transparent;
    }
    .font-size-option:hover{ background:var(--card); }
    .font-size-option.selected{
      background:var(--accent);
      color:var(--bg);
      border-color:var(--accent);
    }

    .reset-wrap{
      padding:24px 0 12px;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .reset-btn{
      align-self:flex-start;
      padding:10px 16px;
      border:1px solid var(--line);
      border-radius:12px;
      background:transparent;
      color:var(--muted);
      font-size:14px;
      font-weight:650;
      cursor:pointer;
      -webkit-tap-highlight-color:transparent;
    }
    .reset-btn:hover{ color:var(--fg); border-color:var(--muted); }
    .reset-sub{ font-size:12px; font-weight:600; color:var(--muted); }

    @media (min-width:768px){
      :root{
        --ui:16px;
        --q:clamp(44px, 4.4vw, 56px);
        --a:clamp(20px, 1.7vw, 24px);
        --pad:24px;
      }
      .question-wrap{ padding:32px 0 200px; }
    }
  </style>
</head>

<body class="theme-light">
  <div class="app">
    <header>
      <button class="icon-btn" id="menuBtn" aria-label="Menu"><svg viewBox="0 0 24 24" class="btn-icon" aria-hidden="true"><path d="M4 6h16M4 12h16M4 18h16"/></svg></button>
      <div class="header-title" id="headerTitle">Question</div>
      <button class="icon-btn" id="backBtn" aria-label="Retour aux questions" style="display:none;"><svg viewBox="0 0 24 24" class="btn-icon" aria-hidden="true"><path d="M18 6L6 18M6 6l12 12"/></svg></button>
      <button class="icon-btn" id="settingsBtn" aria-label="Réglages"><svg viewBox="0 0 24 24" class="btn-icon filled" aria-hidden="true"><path d="M14.647 4.081a.724 .724 0 0 0 1.08 .448c2.439 -1.485 5.23 1.305 3.745 3.744a.724 .724 0 0 0 .447 1.08c2.775 .673 2.775 4.62 0 5.294a.724 .724 0 0 0 -.448 1.08c1.485 2.439 -1.305 5.23 -3.744 3.745a.724 .724 0 0 0 -1.08 .447c-.673 2.775 -4.62 2.775 -5.294 0a.724 .724 0 0 0 -1.08 -.448c-2.439 1.485 -5.23 -1.305 -3.745 -3.744a.724 .724 0 0 0 -.447 -1.08c-2.775 -.673 -2.775 -4.62 0 -5.294a.724 .724 0 0 0 .448 -1.08c-1.485 -2.439 1.305 -5.23 3.744 -3.745a.722 .722 0 0 0 1.08 -.447c.673 -2.775 4.62 -2.775 5.294 0zm-2.647 4.919a3 3 0 1 0 0 6a3 3 0 0 0 0 -6z"/></svg></button>
    </header>

    <main>
      <div class="settings-backdrop" id="settingsBackdrop" aria-hidden="true"></div>
      <section id="questionView" class="view active" aria-label="Question">
        <div class="question-wrap">
          <div class="center">
            <div class="qnum" id="qNum">QUESTION 1</div>
            <h2 class="qtext" id="qText">Who made you?</h2>
            <div class="divider" aria-hidden="true"></div>

            <p class="answer" id="aText">God.</p>
          </div>

          <div class="nav" aria-label="Navigation et actions">
            <div class="actions" aria-label="Actions">
              <button class="mini bookmarkBtn" id="bookmarkBtn" aria-label="Ajouter aux favoris" title="Favori">
                <svg viewBox="0 0 24 24" class="btn-icon" aria-hidden="true"><path class="star-outline" d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/><path class="star-fill btn-icon filled" d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
              </button>
              <button class="pill-btn" id="toggleAnswer">Masquer la réponse</button>
              <button class="mini" id="shuffleBtn" aria-label="Question aléatoire" title="Mélanger">
                <svg viewBox="0 0 24 24" class="btn-icon" aria-hidden="true"><path d="M16 3h5v5M4 20L21 3M21 16v5h-5M15 15l6 6M4 4l5 5"/></svg>
              </button>
            </div>
            <div class="nav-row">
              <button class="arrow" id="prevBtn" aria-label="Précédent"><svg viewBox="0 0 24 24" class="btn-icon" aria-hidden="true"><path d="M15 18l-6-6 6-6"/></svg></button>
              <input type="range" id="qSlider" min="0" max="0" value="0" step="1" aria-label="Aller à une question" />
              <button class="arrow" id="nextBtn" aria-label="Suivant"><svg viewBox="0 0 24 24" class="btn-icon" aria-hidden="true"><path d="M9 18l6-6-6-6"/></svg></button>
            </div>
          </div>
        </div>
      </section>

      <section id="listView" class="view" aria-label="Liste">
        <div class="list" id="listContainer"></div>
      </section>

      <section id="catechismView" class="view" aria-label="Le catéchisme">
        <div class="content-card" id="catechismContent"></div>
      </section>

      <section id="aboutView" class="view" aria-label="À propos">
        <div class="content-card" id="aboutContent"></div>
      </section>

      <section id="bookmarksView" class="view" aria-label="Favoris">
        <div class="content-card">
          <div class="list" id="bookmarksList"></div>
        </div>
      </section>

      <section id="settingsView" class="view" aria-label="Réglages">
        <div class="content-card">
          <div class="settings">
            <div class="row">
              <div>
                <label>Vue liste</label>
                <span class="sub">Afficher les questions en liste</span>
              </div>
              <div class="toggle" id="toggleListView" role="switch" aria-checked="false" tabindex="0"><div class="knob"></div></div>
            </div>

            <div class="row">
              <div>
                <label>Réponses visibles</label>
                <span class="sub">Afficher la réponse par défaut</span>
              </div>
              <div class="toggle" id="toggleAnswersOn" role="switch" aria-checked="true" tabindex="0"><div class="knob"></div></div>
            </div>

            <div class="row">
              <div>
                <label>Mode sombre</label>
                <span class="sub">Thème sombre</span>
              </div>
              <div class="toggle" id="toggleDarkMode" role="switch" aria-checked="false" tabindex="0"><div class="knob"></div></div>
            </div>

            <div class="row">
              <div>
                <label>Masquer les flèches</label>
                <span class="sub">Masquer les flèches gauche et droite</span>
              </div>
              <div class="toggle" id="toggleHideArrows" role="switch" aria-checked="false" tabindex="0"><div class="knob"></div></div>
            </div>

            <div class="slider-wrap">
              <div class="lbl">
                <span>Taille du texte</span>
              </div>
              <div class="font-size-options" role="group" aria-label="Choix de la taille">
                <button type="button" class="font-size-option" id="fontSizePetit" data-size="24">Petit</button>
                <button type="button" class="font-size-option" id="fontSizeMoyen" data-size="32">Moyen</button>
                <button type="button" class="font-size-option" id="fontSizeGrand" data-size="42">Grand</button>
              </div>
            </div>

            <div class="reset-wrap">
              <button type="button" class="reset-btn" id="resetDataBtn">Réinitialiser les données</button>
              <span class="reset-sub">Efface les favoris et les réglages. Cette action est irréversible.</span>
            </div>
          </div>
        </div>
      </section>
    </main>

    <div class="sheet-backdrop" id="sheetBackdrop" aria-hidden="true"></div>

    <div class="sheet" id="menuSheet" role="dialog" aria-modal="true" aria-label="Menu">
      <header>
        <div class="sheet-title">Menu</div>
        <button class="icon-btn" id="closeMenuBtn" aria-label="Fermer"><svg viewBox="0 0 24 24" class="btn-icon" aria-hidden="true"><path d="M18 6L6 18M6 6l12 12"/></svg></button>
      </header>
      <div class="sheet-body">
        <div class="menu-list">
          <button class="menu-item" id="goCatechism">Le catéchisme<small>Origine et contexte</small></button>
          <button class="menu-item" id="goAbout">À propos<small>Informations sur l’app</small></button>
          <button class="menu-item" id="goBookmarks">Favoris<small>Questions en favoris</small></button>
        </div>
        <div style="margin-top:12px; color:var(--muted); font-size:12px; font-weight:700;">
          Version <span id="versionLabel">1.0.0</span>
        </div>
      </div>
    </div>
  </div>

  <script>
    const APP_VERSION = "1.0.0";

    const QUESTIONS = [
      { id: 1, question: "Qui t'a créé?", answer: "Dieu m'a créé." },
      { id: 2, question: "Quoi d'autre Dieu a-t-il créé?", answer: "Dieu a créé toutes choses." },
      { id: 3, question: "Pourquoi Dieu t'a-t-il créé, ainsi que toutes choses?", answer: "Dieu m'a créé, ainsi que toutes choses, pour sa gloire." },
      { id: 4, question: "Comment peux-tu glorifier Dieu?", answer: "Je peux glorifier Dieu en l'aimant et en faisant ce qu'il dit." },
      { id: 5, question: "Pourquoi devrais-tu glorifier Dieu?", answer: "Je devrais glorifier Dieu parce qu'il m'a créé et prend soin de moi." },
      { id: 6, question: "Y a-t-il plus d'un dieu?", answer: "Non. Il n'y a qu'un seul Dieu." },
      { id: 7, question: "En combien de personnes ce seul Dieu existe-t-il?", answer: "Dieu existe en trois personnes." },
      { id: 8, question: "Qui sont-elles?", answer: "Le Père, le Fils et le Saint-Esprit." },
      { id: 9, question: "Qu'est-ce que Dieu?", answer: "Dieu est un Esprit et n'a pas un corps comme l'homme." },
      { id: 10, question: "Où est Dieu?", answer: "Dieu est partout." },
      { id: 11, question: "Peux-tu voir Dieu?", answer: "Non. Je ne peux pas voir Dieu, mais il me voit toujours." },
      { id: 12, question: "Dieu sait-il toutes choses?", answer: "Oui. Rien ne peut être caché à Dieu." },
      { id: 13, question: "Dieu peut-il tout faire?", answer: "Oui. Dieu peut accomplir toute sa sainte volonté." },
      { id: 14, question: "Où apprends-tu à aimer et à obéir à Dieu?", answer: "Nous apprenons à aimer et à obéir à Dieu uniquement dans la Bible." },
      { id: 15, question: "Qui a écrit la Bible?", answer: "Dieu a permis à des hommes saints, enseignés par le Saint-Esprit, d'écrire la Bible." },
      { id: 16, question: "Qui furent nos premiers parents?", answer: "Adam et Ève furent nos premiers parents." },
      { id: 17, question: "De quoi nos premiers parents furent-ils faits?", answer: "Dieu forma Adam de la poussière du sol et forma Ève à partir du corps d'Adam." },
      { id: 18, question: "Qu'est-ce que Dieu donna à Adam et Ève, en plus de leurs corps?", answer: "Dieu donna à Adam et Ève des âmes qui ne peuvent jamais mourir." },
      { id: 19, question: "As-tu une âme, ainsi qu'un corps?", answer: "Oui. J'ai une âme qui ne peut jamais mourir." },
      { id: 20, question: "Qu'est-ce que ton âme?", answer: "Mon âme inclut tout de moi qui devrait connaître et aimer Dieu." },
      { id: 21, question: "Dans quel état Dieu créa-t-il Adam et Ève?", answer: "Dieu créa Adam et Ève saints et heureux." },
      { id: 22, question: "Adam et Ève restèrent-ils saints et heureux?", answer: "Non. Ils péchèrent contre Dieu." },
      { id: 23, question: "Quel fut le péché de nos premiers parents?", answer: "Ils péchèrent contre Dieu en mangeant le fruit défendu." },
      { id: 24, question: "Pourquoi mangèrent-ils le fruit défendu?", answer: "Ils mangèrent le fruit défendu parce qu'ils ne crurent pas ce que Dieu avait dit." },
      { id: 25, question: "Qui les tenta à ce péché?", answer: "Satan tenta Ève, et elle donna le fruit à Adam." },
      { id: 26, question: "Que leur arriva-t-il lorsqu'ils péchèrent?", answer: "Au lieu d'être saints et heureux, ils devinrent pécheurs et misérables." },
      { id: 27, question: "Quel effet le péché d'Adam eut-il sur tous les hommes?", answer: "Tous les hommes naissent dans un état de péché et de misère." },
      { id: 28, question: "Qu'héritons-nous d'Adam à cause du péché originel?", answer: "Nous héritons d'Adam une nature pécheresse." },
      { id: 29, question: "Qu'est-ce que le péché?", answer: "Le péché est le fait de ne pas faire ce que Dieu commande." },
      { id: 30, question: "De quelles manières péchons-nous?", answer: "Nous péchons par pensée, par parole et par action." },
      { id: 31, question: "Que mérite chaque péché?", answer: "Chaque péché mérite la colère et le châtiment de Dieu." },
      { id: 32, question: "Savons-nous ce que Dieu exige de nous?", answer: "Oui. Il nous a donné sa loi dans nos cœurs et par écrit." },
      { id: 33, question: "Quelqu'un peut-il aller au ciel avec cette nature pécheresse?", answer: "Non. Nos cœurs doivent être changés pour être prêts pour le ciel." },
      { id: 34, question: "Comment appelle-t-on un changement de cœur?", answer: "La régénération est un changement de cœur qui mène à une véritable repentance et à la foi." },
      { id: 35, question: "Qui peut changer le cœur d'un pécheur?", answer: "Seul le Saint-Esprit peut changer le cœur d'un pécheur." },
      { id: 36, question: "Qu'est-ce que la justice de Dieu?", answer: "La justice de Dieu signifie que Dieu fait toujours ce qui est juste et qu'il est la norme ultime de ce qui est juste." },
      { id: 37, question: "Quelqu'un peut-il être sauvé par sa propre justice?", answer: "Non. Personne n'est suffisamment bon devant Dieu." },
      { id: 38, question: "Qu'est-ce qu'une alliance?", answer: "Une alliance est un accord entre deux ou plusieurs personnes." },
      { id: 39, question: "Quelle est la nouvelle alliance?", answer: "La nouvelle alliance est l'accord que Dieu a conclu avec son peuple élu pour les sauver de leurs péchés." },
      { id: 40, question: "Que Christ a-t-il entrepris dans la nouvelle alliance?", answer: "Christ a entrepris de garder toute la loi pour son peuple et de subir le châtiment dû à leurs péchés." },
      { id: 41, question: "Que Dieu le Père a-t-il entrepris dans la nouvelle alliance?", answer: "Le Père a entrepris de justifier et sanctifier ceux pour qui Christ devait mourir." },
      { id: 42, question: "Notre Seigneur Jésus-Christ a-t-il jamais commis un péché?", answer: "Non. Notre Seigneur Jésus-Christ était saint et sans péché." },
      { id: 43, question: "Comment le Fils de Dieu a-t-il pu subir la colère et le jugement de Dieu?", answer: "Christ, le Fils de Dieu, est devenu homme, afin d'obéir et de souffrir en tant qu'homme." },
      { id: 44, question: "Qu'est-ce que l'élection?", answer: "L'élection est la bonté de Dieu révélée dans sa grâce en choisissant certains pécheurs pour le salut." },
      { id: 45, question: "Qu'est-ce que l'adoption?", answer: "L'adoption est la bonté de Dieu en amenant les pécheurs repentants dans sa propre famille et en les traitant comme ses enfants bien-aimés." },
      { id: 46, question: "Comment sais-tu que tu es enfant de Dieu?", answer: "Je sais que je suis enfant de Dieu parce que le Saint-Esprit m'assure de cela et me rend capable d'aimer Dieu et les autres." },
      { id: 47, question: "Qu'est-ce que l'expiation?", answer: "L'expiation est Christ qui satisfait la justice divine par ses souffrances et sa mort à la place des pécheurs." },
      { id: 48, question: "Qu'est-ce que la justification?", answer: "La justification est Dieu qui pardonne les pécheurs et les considère comme justes parce qu'ils sont en Christ." },
      { id: 49, question: "Comment pouvons-nous être justifiés?", answer: "Nous pouvons être justifiés seulement en faisant confiance à Christ pour qu'il enlève nos péchés." },
      { id: 50, question: "Qu'est-ce que la sanctification?", answer: "La sanctification est Dieu qui rend les pécheurs saints dans leur cœur et leur conduite, afin qu'ils manifestent sa bonté dans leur vie." },
      { id: 51, question: "Ce processus de sanctification est-il jamais achevé dans cette vie?", answer: "Non. La sanctification est certaine et continue, mais elle n'est complète qu'au ciel." },
      { id: 52, question: "Quel lien y a-t-il entre la justification et la sanctification?", answer: "La justification et la sanctification découlent toutes deux de l'union avec Christ." },
      { id: 53, question: "Pour qui Christ a-t-il obéi à la loi et souffert la colère et le jugement de Dieu?", answer: "Christ a obéi à la loi et a souffert la colère et le jugement de Dieu pour ceux que le Père lui a donnés." },
      { id: 54, question: "Quelle sorte de vie Christ a-t-il menée sur terre?", answer: "Christ a mené une vie d'obéissance parfaite à la loi de Dieu." },
      { id: 55, question: "Quelle sorte de mort Christ a-t-il subie?", answer: "Christ a subi la mort douloureuse et honteuse de la croix." },
      { id: 56, question: "Comment peux-tu être sauvé?", answer: "Si tu te repens de ton péché et crois en Christ, tu seras sauvé." },
      { id: 57, question: "Que signifie se repentir?", answer: "Se repentir signifie être désolé pour son péché, le haïr et l'abandonner parce qu'il déplaît à Dieu." },
      { id: 58, question: "Que signifie croire ou avoir foi en Christ?", answer: "Une personne qui croit en Christ lui fait confiance seul pour le salut." },
      { id: 59, question: "Peux-tu te repentir et croire en Christ par ta propre force?", answer: "Non. Je ne peux rien faire de bon sans le Saint-Esprit de Dieu." },
      { id: 60, question: "Comment peux-tu recevoir le Saint-Esprit?", answer: "Dieu nous a dit que nous devons prier pour recevoir le Saint-Esprit, mais la preuve de sa présence se voit clairement dans notre confiance et notre amour pour le Seigneur Jésus-Christ." },
      { id: 61, question: "Comment le Saint-Esprit baptise-t-il les croyants?", answer: "Le Saint-Esprit les intègre au corps de Christ, les rendant vivants parmi tous ceux qui croient véritablement en lui." },
      { id: 62, question: "Comment le Saint-Esprit scelle-t-il les croyants?", answer: "Le Saint-Esprit vient habiter en eux pour garantir qu'ils recevront les richesses que Dieu a promises à ceux qui l'aiment." },
      { id: 63, question: "Comment les pieux furent-ils sauvés avant la venue de Christ?", answer: "Ils croyaient en la promesse de Dieu." },
      { id: 64, question: "Comment manifestaient-ils leur foi?", answer: "Ils offraient des sacrifices selon les commandements de Dieu." },
      { id: 65, question: "Que représentaient ces sacrifices?", answer: "Ces sacrifices représentaient Christ, l'Agneau de Dieu, qui devait mourir pour les pécheurs." },
      { id: 66, question: "Que fait Christ pour son peuple?", answer: "Christ accomplit l'œuvre d'un prophète, d'un prêtre et d'un roi." },
      { id: 67, question: "Comment Christ est-il notre Prophète?", answer: "Christ, notre Prophète, nous enseigne la volonté de Dieu, nous révèle Dieu et était vraiment Dieu en chair humaine." },
      { id: 68, question: "Pourquoi as-tu besoin de Christ comme Prophète?", answer: "J'ai besoin de Christ comme Prophète parce que je manque de compréhension." },
      { id: 69, question: "Comment Christ est-il notre Prêtre?", answer: "Christ, notre Prêtre, est mort pour nos péchés et intercède auprès de Dieu pour nous." },
      { id: 70, question: "Pourquoi as-tu besoin de Christ comme Prêtre?", answer: "J'ai besoin de Christ comme Prêtre parce que je suis coupable." },
      { id: 71, question: "Comment Christ est-il notre Roi?", answer: "Christ, notre Roi, règne sur nous et nous défend." },
      { id: 72, question: "Pourquoi as-tu besoin de Christ comme Roi?", answer: "J'ai besoin de Christ comme Roi parce que je suis faible et sans défense." },
      { id: 73, question: "Combien de commandements Dieu a-t-il donnés sur le mont Sinaï?", answer: "Dieu a donné dix commandements sur le mont Sinaï." },
      { id: 74, question: "Que nous enseignent les quatre premiers commandements?", answer: "Les quatre premiers commandements enseignent notre devoir envers Dieu." },
      { id: 75, question: "Que nous enseignent les six derniers commandements?", answer: "Les six derniers commandements enseignent notre devoir envers notre prochain." },
      { id: 76, question: "Quel est le résumé des Dix Commandements?", answer: "Le résumé des Dix Commandements est d'aimer Dieu de tout notre cœur et d'aimer notre prochain comme nous-mêmes." },
      { id: 77, question: "Qui est ton prochain?", answer: "Tout le monde est mon prochain." },
      { id: 78, question: "Dieu est-il satisfait de ceux qui l'aiment et lui obéissent?", answer: "Oui. Dieu est satisfait de ceux qui l'aiment et lui obéissent." },
      { id: 79, question: "Dieu est-il mécontent de ceux qui ne l'aiment pas et ne lui obéissent pas?", answer: "Oui. Dieu est mécontent de ceux qui ne l'aiment pas et ne lui obéissent pas." },
      { id: 80, question: "Quel est le premier commandement?", answer: "Tu n'auras pas d'autres dieux devant moi." },
      { id: 81, question: "Que nous enseigne le premier commandement?", answer: "À adorer seulement Dieu." },
      { id: 82, question: "Quel est le deuxième commandement?", answer: "Tu ne te feras pas d'idole, ni d'image taillée. Tu ne te prosterneras pas devant elles." },
      { id: 83, question: "Que nous enseigne le deuxième commandement?", answer: "À adorer Dieu de la bonne manière et à ne pas adorer d'idoles." },
      { id: 84, question: "Quel est le troisième commandement?", answer: "Tu ne prendras pas le nom de l'Éternel, ton Dieu, en vain." },
      { id: 85, question: "Que nous enseigne le troisième commandement?", answer: "À honorer et respecter le nom, la Parole et les œuvres de Dieu." },
      { id: 86, question: "Quel est le quatrième commandement?", answer: "Souviens-toi du jour du repos, pour le sanctifier." },
      { id: 87, question: "Que nous enseigne le quatrième commandement?", answer: "À trouver notre repos en Christ seul pour le salut." },
      { id: 88, question: "Quel jour de la semaine est le jour du Seigneur?", answer: "Le premier jour de la semaine est appelé le jour du Seigneur." },
      { id: 89, question: "Pourquoi est-il appelé le jour du Seigneur?", answer: "Il est appelé ainsi parce que ce jour-là, Christ est ressuscité des morts." },
      { id: 90, question: "Comment doit-on observer le jour du Seigneur?", answer: "On doit observer le jour du Seigneur par la prière, la louange, l'écoute et la lecture de la Parole de Dieu, et en faisant du bien à notre prochain." },
      { id: 91, question: "Quel est le cinquième commandement?", answer: "Honore ton père et ta mère." },
      { id: 92, question: "Que nous enseigne le cinquième commandement?", answer: "À aimer et obéir à nos parents." },
      { id: 93, question: "Quel est le sixième commandement?", answer: "Tu ne tueras point." },
      { id: 94, question: "Que nous enseigne le sixième commandement?", answer: "À éviter la haine, tout ce qui y mène et tout ce qui en découle." },
      { id: 95, question: "Quel est le septième commandement?", answer: "Tu ne commettras point d'adultère." },
      { id: 96, question: "Que nous enseigne le septième commandement?", answer: "À être pur dans nos pensées, nos paroles et nos actions." },
      { id: 97, question: "Quel est le huitième commandement?", answer: "Tu ne déroberas point." },
      { id: 98, question: "Que nous enseigne le huitième commandement?", answer: "À être honnête et à ne pas prendre les choses des autres." },
      { id: 99, question: "Quel est le neuvième commandement?", answer: "Tu ne porteras point de faux témoignage contre ton prochain." },
      { id: 100, question: "Que nous enseigne le neuvième commandement?", answer: "À dire la vérité et à ne pas parler en mal des autres." },
      { id: 101, question: "Quel est le dixième commandement?", answer: "Tu ne convoiteras point." },
      { id: 102, question: "Que nous enseigne le dixième commandement?", answer: "À être content de ce que nous avons." },
      { id: 103, question: "Quelqu'un peut-il observer parfaitement les Dix Commandements?", answer: "Personne, depuis la chute d'Adam, à l'exception de Jésus, n'a jamais observé parfaitement les Dix Commandements." },
      { id: 104, question: "À quoi servent les Dix Commandements?", answer: "Ils nous enseignent notre devoir, nous montrent notre culpabilité et notre besoin d'un Sauveur." },
      { id: 105, question: "Qu'est-ce que la prière?", answer: "La prière est parler avec Dieu." },
      { id: 106, question: "Au nom de qui devons-nous prier?", answer: "Nous devons prier au nom du Seigneur Jésus-Christ." },
      { id: 107, question: "Que Christ nous a-t-il donné pour nous enseigner comment prier?", answer: "La prière du Seigneur." },
      { id: 108, question: "Combien de requêtes y a-t-il dans la prière du Seigneur?", answer: "Six." },
      { id: 109, question: "Quelle est la première requête?", answer: "Que ton nom soit sanctifié." },
      { id: 110, question: "Que demandons-nous dans la première requête?", answer: "Que le nom de Dieu soit honoré par nous et par tous les hommes." },
      { id: 111, question: "Quelle est la deuxième requête?", answer: "Que ton règne vienne." },
      { id: 112, question: "Que demandons-nous dans la deuxième requête?", answer: "Que l'Évangile soit prêché dans le monde entier, cru et obéi par nous et par tous les hommes." },
      { id: 113, question: "Quelle est la troisième requête?", answer: "Que ta volonté soit faite sur la terre comme au ciel." },
      { id: 114, question: "Que demandons-nous dans la troisième requête?", answer: "Que les hommes sur terre servent Dieu comme les anges le font dans le ciel." },
      { id: 115, question: "Quelle est la quatrième requête?", answer: "Donne-nous aujourd'hui notre pain quotidien." },
      { id: 116, question: "Que demandons-nous dans la quatrième requête?", answer: "Que Dieu nous donne tout ce dont nous avons besoin pour notre corps et notre âme." },
      { id: 117, question: "Quelle est la cinquième requête?", answer: "Pardonne-nous nos offenses, comme nous aussi nous pardonnons à ceux qui nous ont offensés." },
      { id: 118, question: "Que demandons-nous dans la cinquième requête?", answer: "Que Dieu pardonne nos péchés pour l'amour de Christ et nous aide à pardonner à ceux qui nous ont offensés." },
      { id: 119, question: "Quelle est la sixième requête?", answer: "Ne nous induis pas en tentation, mais délivre-nous du mal." },
      { id: 120, question: "Que demandons-nous dans la sixième requête?", answer: "Que Dieu nous garde du péché." },
      { id: 121, question: "Que nous enseigne la prière?", answer: "Notre dépendance totale envers Dieu." },
      { id: 122, question: "Comment le Saint-Esprit nous apporte-t-il le salut?", answer: "Il utilise la Bible, qui est la Parole de Dieu." },
      { id: 123, question: "Comment pouvons-nous connaître la Parole de Dieu?", answer: "Nous sommes commandés d'écouter, de lire et d'examiner les Écritures." },
      { id: 124, question: "Qu'est-ce qu'une Église?", answer: "Une Église est une assemblée de croyants baptisés, unis par une alliance de discipline et de témoignage, qui se réunissent régulièrement sous la prédication de la Parole de Dieu." },
      { id: 125, question: "Quelles sont les deux ordonnances que Christ a données à l'Église?", answer: "Le baptême et la Sainte-Cène." },
      { id: 126, question: "Pourquoi Christ a-t-il donné ces ordonnances?", answer: "Pour montrer que ses disciples lui appartiennent et pour leur rappeler ce qu'il a fait pour eux." },
      { id: 127, question: "Qu'est-ce que le baptême?", answer: "Le baptême est l'immersion des croyants dans l'eau, comme signe de leur union avec Christ dans sa mort, son ensevelissement et sa résurrection." },
      { id: 128, question: "Que représente le baptême?", answer: "Le baptême représente aux croyants que Dieu les a purifiés de leurs péchés par Jésus-Christ." },
      { id: 129, question: "Qui doit être baptisé?", answer: "Seuls ceux qui se repentent de leurs péchés et croient en Christ pour le salut doivent être baptisés." },
      { id: 130, question: "Les bébés doivent-ils être baptisés?", answer: "Non. Seules les personnes qui font une profession de foi crédible en Christ doivent être baptisées." },
      { id: 131, question: "Christ accueille-t-il les petits enfants?", answer: "Oui. Il invite les petits enfants à venir à lui par la foi." },
      { id: 132, question: "Qu'est-ce que la Sainte-Cène?", answer: "À la Sainte-Cène, l'Église mange du pain et boit du vin pour se souvenir des souffrances et de la mort de notre Seigneur Jésus-Christ." },
      { id: 133, question: "Que représente le pain?", answer: "Le pain représente le corps de Christ, brisé pour nos péchés." },
      { id: 134, question: "Que représente le vin?", answer: "Le vin représente le sang de Christ, versé pour notre salut." },
      { id: 135, question: "Qui doit participer à la Sainte-Cène?", answer: "La Sainte-Cène est pour ceux qui se repentent de leurs péchés, croient en Christ pour le salut, ont reçu le baptême et aiment leurs frères et sœurs." },
      { id: 136, question: "Christ est-il resté dans le tombeau après sa crucifixion?", answer: "Non. Il est ressuscité le troisième jour après sa mort." },
      { id: 137, question: "Où est Christ maintenant?", answer: "Christ est au ciel, assis à la droite de Dieu le Père." },
      { id: 138, question: "Christ reviendra-t-il?", answer: "Oui. Au dernier jour, il reviendra pour juger le monde." },
      { id: 139, question: "Que devient l'homme à sa mort?", answer: "Le corps retourne à la poussière, et l'âme va soit auprès de Dieu, soit dans un lieu de souffrance en attendant la résurrection pour le jugement." },
      { id: 140, question: "Les corps des morts ressusciteront-ils à la vie?", answer: "Oui. Il y aura une résurrection des morts, tant des justes que des méchants." },
      { id: 141, question: "Que deviendra-t-il des méchants au jour du jugement?", answer: "Ils seront jetés en enfer." },
      { id: 142, question: "Qu'est-ce que l'enfer?", answer: "L'enfer est un lieu de châtiment terrible et éternel." },
      { id: 143, question: "Que deviendra-t-il des justes au jour du jugement?", answer: "Ils vivront avec Christ pour toujours, dans un nouveau ciel et une nouvelle terre." },
      { id: 144, question: "À la lumière de ces vérités, que dois-tu faire?", answer: "Je dois m'efforcer de tout mon être de croire au Seigneur Jésus-Christ et de me repentir de mes péchés." },
      { id: 145, question: "Qu'est-ce que l'Évangile?", answer: "Le Dieu saint, par amour, s'est fait homme parfait pour porter ma condamnation. Sur la croix, il a pris mon péché, et par sa mort, je vis à nouveau." }
    ];

    const CATECHISM_TEXT = "Ce catéchisme s'appuie sur les doctrines baptistes historiques, dans la lignée des Confessions de foi baptistes de Londres (1644 et 1689). Il s'agit d'une adaptation du Catéchisme baptiste, publié pour la première fois au XVIIe siècle, lui-même basé sur le Petit Catéchisme de Westminster. Le langage et les formulations ont été modernisés et adaptés pour un usage auprès des jeunes enfants. Ce catéchisme a été publié précédemment sous le titre The Catechism for Boys and Girls par Carey Publications.";

    const ABOUT_TEXT = {
      title: "À propos",
      paragraphs: [
        "Cette application présente un catéchisme de façon claire et accessible, avec une navigation simple, des favoris et des options de lecture.",
        "Vous pouvez basculer entre la vue question et la vue liste, afficher ou masquer les réponses par défaut, activer le mode sombre, masquer les flèches de navigation et ajuster la taille du texte.",
        "Les données sont enregistrées localement dans votre navigateur (réglages et favoris).",
        "Sur ordinateur, vous pouvez utiliser les touches suivantes : V pour basculer entre vue question et vue liste, Espace pour afficher ou masquer les réponses, S pour une question aléatoire, F pour ajouter ou retirer des favoris.",
        "Fabriqué avec ❤️ par KeachLabs."
      ]
    };

    const els = {
      headerTitle: document.getElementById("headerTitle"),
      questionView: document.getElementById("questionView"),
      listView: document.getElementById("listView"),
      catechismView: document.getElementById("catechismView"),
      catechismContent: document.getElementById("catechismContent"),
      aboutView: document.getElementById("aboutView"),
      bookmarksView: document.getElementById("bookmarksView"),
      settingsView: document.getElementById("settingsView"),
      qNum: document.getElementById("qNum"),
      qText: document.getElementById("qText"),
      aText: document.getElementById("aText"),
      toggleAnswer: document.getElementById("toggleAnswer"),
      qSlider: document.getElementById("qSlider"),
      prevBtn: document.getElementById("prevBtn"),
      nextBtn: document.getElementById("nextBtn"),
      bookmarkBtn: document.getElementById("bookmarkBtn"),
      shuffleBtn: document.getElementById("shuffleBtn"),
      listContainer: document.getElementById("listContainer"),
      bookmarksList: document.getElementById("bookmarksList"),
      aboutContent: document.getElementById("aboutContent"),
      menuBtn: document.getElementById("menuBtn"),
      backBtn: document.getElementById("backBtn"),
      settingsBtn: document.getElementById("settingsBtn"),
      settingsBackdrop: document.getElementById("settingsBackdrop"),
      sheetBackdrop: document.getElementById("sheetBackdrop"),
      menuSheet: document.getElementById("menuSheet"),
      closeMenuBtn: document.getElementById("closeMenuBtn"),
      goCatechism: document.getElementById("goCatechism"),
      goBookmarks: document.getElementById("goBookmarks"),
      goAbout: document.getElementById("goAbout"),
      versionLabel: document.getElementById("versionLabel"),
      toggleListView: document.getElementById("toggleListView"),
      toggleAnswersOn: document.getElementById("toggleAnswersOn"),
      toggleDarkMode: document.getElementById("toggleDarkMode"),
      toggleHideArrows: document.getElementById("toggleHideArrows"),
      fontSizePetit: document.getElementById("fontSizePetit"),
      fontSizeMoyen: document.getElementById("fontSizeMoyen"),
      fontSizeGrand: document.getElementById("fontSizeGrand"),
      resetDataBtn: document.getElementById("resetDataBtn"),
    };

    const STORAGE_KEY = "catechism_app_state_v1";

    function loadState(){
      const base = {
        currentIndex: 0,
        showAnswer: true,
        darkMode: false,
        hideArrows: false,
        listView: false,
        fontSize: 32,
        bookmarks: []
      };
      function systemDark(){ return typeof window !== "undefined" && window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches; }
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw){
          base.darkMode = systemDark();
          return base;
        }
        const parsed = JSON.parse(raw);
        const out = { ...base, ...parsed };
        return out;
      }catch{
        base.darkMode = systemDark();
        return base;
      }
    }

    const state = loadState();

    let _saveStateTimer;
    function saveState(){
      clearTimeout(_saveStateTimer);
      _saveStateTimer = setTimeout(function(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }, 200);
    }
    function saveStateNow(){ clearTimeout(_saveStateTimer); localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }
    function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }
    function escapeHtml(s){ return String(s).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"); }
    function getCurrentQuestion(){ return QUESTIONS[state.currentIndex] || QUESTIONS[0]; }

    function setTheme(){
      document.body.classList.toggle("theme-dark", !!state.darkMode);
      document.body.classList.toggle("theme-light", !state.darkMode);
    }

    function setFontSize(){
      const v = clamp(state.fontSize, 24, 42);
      const sizePetit = els.fontSizePetit; const sizeMoyen = els.fontSizeMoyen; const sizeGrand = els.fontSizeGrand;
      if(sizePetit){ sizePetit.classList.toggle("selected", v <= 28); }
      if(sizeMoyen){ sizeMoyen.classList.toggle("selected", v > 28 && v < 37); }
      if(sizeGrand){ sizeGrand.classList.toggle("selected", v >= 37); }
      const aSize = v <= 28 ? 12 : v < 37 ? 16 : 20;
      document.documentElement.style.setProperty("--q", `${v}px`);
      document.documentElement.style.setProperty("--a", `${aSize}px`);
    }

    let _currentView = "";
    function showView(name){
      if(_currentView === name) return;
      _currentView = name;
      const map = {
        question: els.questionView,
        list: els.listView,
        catechism: els.catechismView,
        about: els.aboutView,
        bookmarks: els.bookmarksView,
        settings: els.settingsView
      };
      for(const k in map) map[k].classList.remove("active");
      map[name].classList.add("active");

      if(name === "settings") els.settingsBackdrop.classList.add("show");
      else els.settingsBackdrop.classList.remove("show");

      const titleMap = { question: "Question", list: "Vue liste", catechism: "Le catéchisme", about: "À propos", bookmarks: "Favoris", settings: "Réglages" };
      els.headerTitle.textContent = titleMap[name] || "Question";

      const showBack = (name === "catechism" || name === "about" || name === "bookmarks" || name === "settings");
      els.backBtn.style.display = showBack ? "" : "none";
      els.settingsBtn.style.display = showBack ? "none" : "";
    }

    function leaveSettings(){
      els.settingsBackdrop.classList.remove("show");
      if(state.listView){
        renderList();
        showView("list");
      }else{
        showView("question");
      }
    }

    function renderQuestion(){
      const q = getCurrentQuestion();
      els.qNum.textContent = "QUESTION " + (state.currentIndex + 1);
      els.qText.textContent = q.question;
      els.aText.textContent = q.answer;

      if(state.showAnswer){
        els.aText.classList.remove("hidden");
        els.toggleAnswer.textContent = "Masquer la réponse";
      }else{
        els.aText.classList.add("hidden");
        els.toggleAnswer.textContent = "Montrer la réponse";
      }

      const isBookmarked = state.bookmarks.includes(q.id);
      els.bookmarkBtn.classList.toggle("is-bookmarked", isBookmarked);
      els.bookmarkBtn.setAttribute("aria-label", isBookmarked ? "Retirer des favoris" : "Ajouter aux favoris");

      els.qSlider.min = "0";
      els.qSlider.max = String(QUESTIONS.length - 1);
      els.qSlider.value = String(state.currentIndex);

      els.prevBtn.disabled = state.currentIndex <= 0;
      els.nextBtn.disabled = state.currentIndex >= QUESTIONS.length - 1;

      els.prevBtn.style.display = state.hideArrows ? "none" : "";
      els.nextBtn.style.display = state.hideArrows ? "none" : "";
    }

    function renderList(){
      const frag = document.createDocumentFragment();
      for(let idx = 0; idx < QUESTIONS.length; idx++){
        const q = QUESTIONS[idx];
        const row = document.createElement("div");
        row.className = "list-item";
        if(state.showAnswer) row.classList.add("expanded");
        row.dataset.index = String(idx);
        row.innerHTML = "<div class=\"list-item-row\"><div class=\"n\">" + (idx + 1) + "</div><div class=\"t\">" + q.question + "</div></div><div class=\"list-item-answer\">" + escapeHtml(q.answer) + "</div>";
        frag.appendChild(row);
      }
      els.listContainer.innerHTML = "";
      els.listContainer.appendChild(frag);
    }

    function renderBookmarks(){
      els.bookmarksList.innerHTML = "";
      const bookmarksSet = state.bookmarks.length ? new Set(state.bookmarks) : null;
      if(!bookmarksSet || bookmarksSet.size === 0){
        els.bookmarksList.innerHTML = "<div class=\"list-item list-item-empty\"><div class=\"t\">Aucun favori.</div></div>";
        return;
      }
      const frag = document.createDocumentFragment();
      for(let i = 0; i < QUESTIONS.length; i++){
        if(!bookmarksSet.has(QUESTIONS[i].id)) continue;
        const row = document.createElement("div");
        row.className = "list-item";
        row.dataset.index = String(i);
        row.innerHTML = "<div class=\"list-item-row\"><div class=\"n\">" + (i + 1) + "</div><div class=\"t\">" + QUESTIONS[i].question + "</div></div>";
        frag.appendChild(row);
      }
      els.bookmarksList.appendChild(frag);
    }

    function renderCatechism(){
      els.catechismContent.innerHTML = "<p>" + CATECHISM_TEXT + "</p>";
    }

    function renderAbout(){
      els.aboutContent.innerHTML = ABOUT_TEXT.paragraphs.map(p => "<p>" + p + "</p>").join("");
    }

    function toggle(el, value){
      el.classList.toggle("on", !!value);
      el.setAttribute("aria-checked", value ? "true" : "false");
    }

    function openMenu(){
      els.sheetBackdrop.classList.add("show");
      els.menuSheet.classList.add("show");
      document.body.style.overflow = "hidden";
    }
    function closeMenu(){
      els.sheetBackdrop.classList.remove("show");
      els.menuSheet.classList.remove("show");
      document.body.style.overflow = "";
    }

    /* Events: lecture */
    els.toggleAnswer.addEventListener("click", () => {
      state.showAnswer = !state.showAnswer;
      toggle(els.toggleAnswersOn, state.showAnswer);
      saveState();
      renderQuestion();
    });

    els.listContainer.addEventListener("click", function(e){
      const row = e.target.closest(".list-item");
      if(!row || row.classList.contains("list-item-empty")) return;
      const idx = parseInt(row.dataset.index, 10);
      if(isNaN(idx)) return;
      const wasExpanded = row.classList.contains("expanded");
      const expanded = els.listContainer.querySelector(".list-item.expanded");
      if(expanded) expanded.classList.remove("expanded");
      if(!wasExpanded) row.classList.add("expanded");
      state.currentIndex = idx;
      saveState();
    });

    els.bookmarksList.addEventListener("click", function(e){
      const row = e.target.closest(".list-item");
      if(!row || row.classList.contains("list-item-empty")) return;
      const idx = parseInt(row.dataset.index, 10);
      if(isNaN(idx)) return;
      state.currentIndex = idx;
      saveState();
      renderQuestion();
      showView("question");
    });

    els.prevBtn.addEventListener("click", () => {
      state.currentIndex = clamp(state.currentIndex - 1, 0, QUESTIONS.length - 1);
      saveState();
      renderQuestion();
    });

    els.nextBtn.addEventListener("click", () => {
      state.currentIndex = clamp(state.currentIndex + 1, 0, QUESTIONS.length - 1);
      saveState();
      renderQuestion();
    });

    els.qSlider.addEventListener("input", e => {
      state.currentIndex = clamp(Number(e.target.value), 0, QUESTIONS.length - 1);
      saveState();
      renderQuestion();
    });

    els.bookmarkBtn.addEventListener("click", () => {
      const id = getCurrentQuestion().id;
      const i = state.bookmarks.indexOf(id);
      if(i === -1) state.bookmarks.push(id);
      else state.bookmarks.splice(i, 1);
      saveState();
      renderQuestion();
    });

    els.shuffleBtn.addEventListener("click", () => {
      if(QUESTIONS.length <= 1) return;
      let n;
      do{ n = Math.floor(Math.random() * QUESTIONS.length); }
      while(n === state.currentIndex);
      state.currentIndex = n;
      saveState();
      renderQuestion();
    });

    /* Menu */
    els.menuBtn.addEventListener("click", openMenu);
    els.closeMenuBtn.addEventListener("click", closeMenu);
    els.sheetBackdrop.addEventListener("click", closeMenu);

    els.goCatechism.addEventListener("click", () => { closeMenu(); renderCatechism(); showView("catechism"); });
    els.goAbout.addEventListener("click", () => { closeMenu(); renderAbout(); showView("about"); });
    els.goBookmarks.addEventListener("click", () => { closeMenu(); renderBookmarks(); showView("bookmarks"); });

    els.backBtn.addEventListener("click", () => {
      if(els.settingsView.classList.contains("active")) leaveSettings();
      else showView("question");
    });

    /* Settings */
    els.settingsBtn.addEventListener("click", () => {
      if(els.settingsView.classList.contains("active")) leaveSettings();
      else showView("settings");
    });

    els.settingsBackdrop.addEventListener("click", leaveSettings);

    els.toggleListView.addEventListener("click", () => {
      state.listView = !state.listView;
      toggle(els.toggleListView, state.listView);
      saveState();
      if(state.listView){
        renderList();
        showView("list");
      }else{
        showView("question");
      }
    });

    els.toggleAnswersOn.addEventListener("click", () => {
      state.showAnswer = !state.showAnswer;
      toggle(els.toggleAnswersOn, state.showAnswer);
      saveState();
      renderQuestion();
    });

    els.toggleDarkMode.addEventListener("click", () => {
      state.darkMode = !state.darkMode;
      toggle(els.toggleDarkMode, state.darkMode);
      setTheme();
      saveState();
    });

    els.toggleHideArrows.addEventListener("click", () => {
      state.hideArrows = !state.hideArrows;
      toggle(els.toggleHideArrows, state.hideArrows);
      saveState();
      renderQuestion();
    });

    [els.fontSizePetit, els.fontSizeMoyen, els.fontSizeGrand].forEach(btn => {
      if(!btn) return;
      btn.addEventListener("click", () => {
        state.fontSize = Number(btn.getAttribute("data-size"));
        setFontSize();
        saveState();
      });
    });

    if(els.resetDataBtn){
      els.resetDataBtn.addEventListener("click", () => {
        if(!confirm("Réinitialiser les favoris et les réglages ? Cette action est irréversible.")) return;
        localStorage.removeItem(STORAGE_KEY);
        location.reload();
      });
    }

    document.addEventListener("keydown", e => {
      const menuOpen = els.menuSheet.classList.contains("show");
      const isDesktop = window.matchMedia("(min-width: 768px)").matches;
      const inInput = e.target.closest("input") || e.target.closest("textarea") || e.target.closest("[contenteditable]");

      if(e.key === "Escape"){
        if(menuOpen){ closeMenu(); e.preventDefault(); }
        return;
      }

      /* Raccourcis desktop: V = bascule vue question/liste, Espace = afficher/masquer réponses */
      if(isDesktop && !menuOpen && !inInput){
        if(e.key === "v" || e.key === "V"){
          state.listView = !state.listView;
          toggle(els.toggleListView, state.listView);
          saveState();
          if(state.listView){
            renderList();
            showView("list");
          }else{
            showView("question");
          }
          e.preventDefault();
          return;
        }
        if((e.key === "s" || e.key === "S") && els.questionView.classList.contains("active")){
          els.shuffleBtn.click();
          e.preventDefault();
          return;
        }
        if((e.key === "f" || e.key === "F") && els.questionView.classList.contains("active")){
          els.bookmarkBtn.click();
          e.preventDefault();
          return;
        }
        if(e.key === " "){
          if(!e.target.closest("button")){
            if(els.questionView.classList.contains("active")){
              state.showAnswer = !state.showAnswer;
              toggle(els.toggleAnswersOn, state.showAnswer);
              saveState();
              renderQuestion();
              e.preventDefault();
            }else if(els.listView.classList.contains("active")){
              state.showAnswer = !state.showAnswer;
              toggle(els.toggleAnswersOn, state.showAnswer);
              saveState();
              renderList();
              e.preventDefault();
            }
          }
          return;
        }
      }

      if(els.questionView.classList.contains("active") && !menuOpen){
        if(e.key === "ArrowLeft"){ els.prevBtn.click(); e.preventDefault(); }
        else if(e.key === "ArrowRight"){ els.nextBtn.click(); e.preventDefault(); }
      }
    });

    (function setupSwipe(){
      const threshold = 60;
      let startX = 0;
      let startY = 0;
      els.questionView.addEventListener("touchstart", e => {
        if(!els.questionView.classList.contains("active") || els.menuSheet.classList.contains("show")) return;
        startX = e.changedTouches[0].clientX;
        startY = e.changedTouches[0].clientY;
      }, { passive: true });
      els.questionView.addEventListener("touchend", e => {
        if(!els.questionView.classList.contains("active") || els.menuSheet.classList.contains("show")) return;
        const endX = e.changedTouches[0].clientX;
        const endY = e.changedTouches[0].clientY;
        const deltaX = endX - startX;
        const deltaY = Math.abs(endY - startY);
        if(Math.abs(deltaX) < threshold || Math.abs(deltaX) < deltaY) return;
        if(deltaX > 0){ els.prevBtn.click(); }
        else{ els.nextBtn.click(); }
      }, { passive: true });
    })();

    window.addEventListener("pagehide", saveStateNow);

    function init(){
      els.versionLabel.textContent = APP_VERSION;

      toggle(els.toggleListView, state.listView);
      toggle(els.toggleAnswersOn, state.showAnswer);
      toggle(els.toggleDarkMode, state.darkMode);
      toggle(els.toggleHideArrows, state.hideArrows);

      setTheme();
      setFontSize();
      renderQuestion();
      showView("question");

      if("serviceWorker" in navigator){
        navigator.serviceWorker.register("service-worker.js").catch(function(){});
      }
    }

    init();
  </script>
</body>
</html>
